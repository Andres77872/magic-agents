# Node Debug Information

This document describes the debug information captured by each node type in the Magic Agents framework.

## Common Information (All Nodes)

All nodes capture these standard fields:

### Standard Fields

| Field | Description |
|-------|-------------|
| `node_id` | Unique identifier for the node instance |
| `node_type` | Type identifier (e.g., "LLM", "TEXT", "CONDITIONAL") |
| `node_class` | Python class name (e.g., "NodeLLM") |
| `start_time` | When node execution started |
| `end_time` | When node execution completed |
| `execution_duration_ms` | How long the node took to execute |
| `inputs` | All input values received from parent nodes |
| `outputs` | All output values sent to child nodes |
| `was_executed` | Whether the node actually executed |
| `was_bypassed` | Whether the node was bypassed (conditional flow) |
| `error` | Error message if execution failed |

### Common Internal Variables

| Variable | Description |
|----------|-------------|
| `_response` | The final response/content produced by the node |
| `cost` | Cost associated with node execution |
| `extra_params` | Additional parameters passed during initialization |

---

## Node-Specific Information

### NodeLLM (LLM)

**Purpose**: Executes LLM generation with streaming or non-streaming mode.

**Internal Variables**:

| Variable | Type | Description |
|----------|------|-------------|
| `stream` | bool | Whether streaming is enabled |
| `json_output` | bool | Whether to parse output as JSON |
| `iterate` | bool | Whether node re-executes in loops |
| `generated` | string | Text generated by the LLM (truncated to 500 chars) |
| `extra_data` | dict | LLM parameters (temperature, top_p, etc.) |

**Input Handles**:
- `handle-client-provider`: The LLM client instance
- `handle-chat`: Chat history object
- `handle-system-context`: System prompt
- `handle_user_message`: User message

**Output Handles**:
- `content`: Streaming chunks (if stream=true)
- `end`: Final generated content

**Example Debug Output**:
```json
{
  "node_id": "llm-node-1",
  "node_type": "LLM",
  "node_class": "NodeLLM",
  "execution_duration_ms": 1250.5,
  "inputs": {
    "handle_user_message": "Explain quantum computing",
    "handle-client-provider": "<MagicLLM>"
  },
  "outputs": {
    "end": {
      "node": "NodeLLM",
      "content": "Quantum computing is..."
    }
  },
  "internal_variables": {
    "stream": true,
    "json_output": false,
    "iterate": false,
    "generated": "Quantum computing is...",
    "extra_data": {
      "temperature": 0.7,
      "top_p": 0.9
    }
  }
}
```

---

### NodeText (TEXT)

**Purpose**: Outputs static text content.

**Internal Variables**:
- Standard variables only

**Input Handles**: None (static content)

**Output Handles**:
- `end`: The static text

**Example Debug Output**:
```json
{
  "node_id": "text-node-1",
  "node_type": "TEXT",
  "node_class": "NodeText",
  "execution_duration_ms": 0.5,
  "inputs": {},
  "outputs": {
    "end": {
      "node": "NodeText",
      "content": "Welcome to the system!"
    }
  },
  "internal_variables": {
    "_response": "Welcome to the system!",
    "cost": 0.0
  }
}
```

---

### NodeUserInput (USER_INPUT)

**Purpose**: Receives input from the user (start node).

**Internal Variables**:
- `text`: The user's input text
- `images`: List of image URLs/paths (if provided)

**Input Handles**: None (receives from user)

**Output Handles**:
- `handle_user_message`: The user's input

**Example Debug Output**:
```json
{
  "node_id": "user-input-1",
  "node_type": "USER_INPUT",
  "node_class": "NodeUserInput",
  "execution_duration_ms": 1.2,
  "inputs": {},
  "outputs": {
    "handle_user_message": {
      "node": "NodeUserInput",
      "content": "What is the weather today?"
    }
  },
  "internal_variables": {
    "_response": "What is the weather today?",
    "cost": 0.0
  }
}
```

---

### NodeConditional (CONDITIONAL)

**Purpose**: Evaluates a condition and routes to appropriate branch.

**Internal Variables**:
- `condition`: The condition expression being evaluated
- `context_data`: Data available for condition evaluation

**Input Handles**:
- Various (depends on condition requirements)

**Output Handles**:
- `handle_true`: Taken if condition evaluates to true
- `handle_false`: Taken if condition evaluates to false

**Example Debug Output**:
```json
{
  "node_id": "conditional-1",
  "node_type": "CONDITIONAL",
  "node_class": "NodeConditional",
  "execution_duration_ms": 2.5,
  "inputs": {
    "input_value": 42
  },
  "outputs": {
    "handle_true": {
      "node": "NodeConditional",
      "content": true
    }
  },
  "internal_variables": {
    "_response": true,
    "condition": "input_value > 10",
    "cost": 0.0
  }
}
```

---

### NodeLoop (LOOP)

**Purpose**: Iterates over a list of items.

**Internal Variables**:
- `iterate`: Always true for loop nodes

**Input Handles**:
- `handle_list`: List of items to iterate
- `handle_loop`: Feedback from each iteration

**Output Handles**:
- `handle_item`: Current item in iteration
- `handle_end`: Aggregated results after all iterations

**Example Debug Output**:
```json
{
  "node_id": "loop-1",
  "node_type": "LOOP",
  "node_class": "NodeLoop",
  "execution_duration_ms": 5000.0,
  "inputs": {
    "handle_list": ["item1", "item2", "item3"]
  },
  "outputs": {
    "handle_end": {
      "node": "NodeLoop",
      "content": ["result1", "result2", "result3"]
    }
  },
  "internal_variables": {
    "_response": ["result1", "result2", "result3"],
    "cost": 0.0
  }
}
```

---

### NodeParser (PARSER)

**Purpose**: Parses and extracts data from input.

**Internal Variables**:
- Parser-specific configuration

**Input Handles**:
- `input`: Content to parse

**Output Handles**:
- `end`: Parsed/extracted data

**Example Debug Output**:
```json
{
  "node_id": "parser-1",
  "node_type": "PARSER",
  "node_class": "NodeParser",
  "execution_duration_ms": 15.0,
  "inputs": {
    "input": "{\"name\": \"John\", \"age\": 30}"
  },
  "outputs": {
    "end": {
      "node": "NodeParser",
      "content": {"name": "John", "age": 30}
    }
  }
}
```

---

### NodeFetch (FETCH)

**Purpose**: Makes HTTP requests to external APIs.

**Internal Variables**:
- `url`: The URL being fetched
- `method`: HTTP method (GET, POST, etc.)
- `headers`: Request headers
- `body`: Request body (if applicable)

**Input Handles**:
- Various (depends on configuration)

**Output Handles**:
- `end`: Response data

**Example Debug Output**:
```json
{
  "node_id": "fetch-1",
  "node_type": "FETCH",
  "node_class": "NodeFetch",
  "execution_duration_ms": 250.0,
  "inputs": {
    "url_param": "https://api.example.com/data"
  },
  "outputs": {
    "end": {
      "node": "NodeFetch",
      "content": {"status": "success", "data": [...]}
    }
  },
  "internal_variables": {
    "url": "https://api.example.com/data",
    "method": "GET",
    "_response": {"status": "success", "data": [...]}
  }
}
```

---

### NodeChat (CHAT)

**Purpose**: Manages conversation history and chat context.

**Internal Variables**:
- Chat history and context

**Input Handles**:
- `handle_user_message`: User message to add to chat

**Output Handles**:
- `handle-chat`: Updated chat object

**Example Debug Output**:
```json
{
  "node_id": "chat-1",
  "node_type": "CHAT",
  "node_class": "NodeChat",
  "execution_duration_ms": 5.0,
  "inputs": {
    "handle_user_message": "Hello!"
  },
  "outputs": {
    "handle-chat": {
      "node": "NodeChat",
      "content": "<ModelChat>"
    }
  }
}
```

---

### NodeInner (INNER)

**Purpose**: Executes a nested sub-graph.

**Internal Variables**:
- `magic_flow`: The inner graph definition
- `inner_graph`: The built inner graph instance

**Input Handles**:
- Various (depends on inner graph)

**Output Handles**:
- Various (depends on inner graph)

**Example Debug Output**:
```json
{
  "node_id": "inner-1",
  "node_type": "INNER",
  "node_class": "NodeInner",
  "execution_duration_ms": 1500.0,
  "inputs": {
    "input_data": "Some input"
  },
  "outputs": {
    "end": {
      "node": "NodeInner",
      "content": "Inner graph result"
    }
  },
  "internal_variables": {
    "_response": "Inner graph result",
    "magic_flow": {...},
    "inner_graph": "<AgentFlowModel>"
  }
}
```

---

### NodeEND (END)

**Purpose**: Marks the end of execution flow.

**Internal Variables**:
- Standard variables only

**Input Handles**:
- Various (any final input)

**Output Handles**: None (terminal node)

**Example Debug Output**:
```json
{
  "node_id": "end-1",
  "node_type": "END",
  "node_class": "NodeEND",
  "execution_duration_ms": 0.1,
  "inputs": {
    "final_result": "Execution complete"
  },
  "outputs": {},
  "internal_variables": {
    "_response": null,
    "cost": 0.0
  }
}
```

---

## Bypassed Nodes

When a node is bypassed (e.g., in a conditional flow where the branch was not taken):

```json
{
  "node_id": "bypassed-node",
  "node_type": "LLM",
  "node_class": "NodeLLM",
  "start_time": null,
  "end_time": null,
  "execution_duration_ms": null,
  "inputs": {},
  "outputs": {},
  "internal_variables": {},
  "was_executed": false,
  "was_bypassed": true,
  "error": null
}
```

---

## Failed Nodes

When a node fails during execution:

```json
{
  "node_id": "failed-node",
  "node_type": "FETCH",
  "node_class": "NodeFetch",
  "start_time": "2023-10-09T23:20:25.000000",
  "end_time": "2023-10-09T23:20:25.500000",
  "execution_duration_ms": 500.0,
  "inputs": {
    "url": "https://invalid-url"
  },
  "outputs": {},
  "internal_variables": {
    "url": "https://invalid-url",
    "method": "GET"
  },
  "was_executed": true,
  "was_bypassed": false,
  "error": "Connection timeout: failed to connect to server"
}
```
